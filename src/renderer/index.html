<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; worker-src 'self' blob:; child-src 'self' blob:; img-src 'self' data: blob:;">
  <title>YOLO-Browser - Autonomous Web Platform</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #1e1e1e;
      color: #d4d4d4;
      overflow: hidden;
    }

    #root {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Loading spinner */
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007acc;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error styles */
    .error-container {
      padding: 20px;
      background-color: #ff6b6b;
      color: white;
      border-radius: 4px;
      margin: 20px;
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="loading-container">
      <div class="spinner"></div>
      <div>Loading YOLO-Browser...</div>
    </div>
  </div>
  
  <script>
    // Global polyfills for Monaco and other dependencies
    if (typeof global === 'undefined') {
      window.global = window;
    }
    if (typeof globalThis === 'undefined') {
      window.globalThis = window;
    }
    
    // Configure Monaco environment before any Monaco scripts load
    window.MonacoEnvironment = {
      getWorker: function (moduleId, label) {
        switch (label) {
          case 'typescript':
          case 'javascript':
            return new Worker('./ts.worker.js');
          case 'css':
          case 'scss':
          case 'less':
            return new Worker('./css.worker.js');
          case 'html':
          case 'handlebars':
          case 'razor':
            return new Worker('./html.worker.js');
          case 'json':
            return new Worker('./json.worker.js');
          default:
            return new Worker('./editor.worker.js');
        }
      }
    };

    // Global error handler (defensive to avoid cascading errors when event.error is null)
    window.addEventListener('error', (event) => {
      try {
        const err = event && event.error;
        const message = (err && typeof err === 'object' && 'message' in err) ? err.message : String(err || (event && event.message) || 'Unknown error');
        // Collapse very noisy repeat errors (same message flooding)
        window.__lastErrorMsg = window.__lastErrorMsg || '';
        if (window.__lastErrorMsg !== message) {
          console.error('Global error:', err);
          window.__lastErrorMsg = message;
        }
          // Ignore pure null error events (likely internal Electron devtools noise) after first diagnostic
          if ((event && event.error) == null) {
            if (!window.__loggedNullErrorSource) {
              window.__loggedNullErrorSource = true;
              console.warn('Null error object event details (suppressed future occurrences):', {
                type: event?.type,
                message: event?.message,
                filename: event?.filename,
                lineno: event?.lineno,
                colno: event?.colno
              });
            }
            return;
          }
        if (window.electronAPI && window.electronAPI.logError) {
          window.electronAPI.logError('Global error: ' + message);
        }
      } catch (inner) {
        // Final fallback â€“ never throw from handler
        console.warn('Global error handler failed', inner);
      }
    });

    // Global unhandled promise rejection handler (defensive)
    window.addEventListener('unhandledrejection', (event) => {
      try {
        const reason = event && event.reason;
        const message = (reason && typeof reason === 'object' && 'message' in reason) ? reason.message : String(reason || 'Unknown rejection');
        window.__lastRejectionMsg = window.__lastRejectionMsg || '';
        if (window.__lastRejectionMsg !== message) {
          console.error('Unhandled promise rejection:', reason);
          window.__lastRejectionMsg = message;
        }
        if (window.electronAPI && window.electronAPI.logError) {
          window.electronAPI.logError('Unhandled promise rejection: ' + message);
        }
      } catch (inner) {
        console.warn('Unhandled rejection handler failed', inner);
      }
      event.preventDefault();
    });

    // Log when the DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, waiting for React app...');
      if (window.electronAPI) {
        window.electronAPI.logInfo('DOM loaded, initializing React app');
      }
    });
  </script>
</body>
</html>
